<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Card Game: Code Quality & Architecture Review</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h3 {
            color: #764ba2;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
        }
        
        h4 {
            color: #555;
            font-size: 1.1em;
            margin: 15px 0 10px 0;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .critical { background: #fee; color: #c00; }
        .warning { background: #ffeaa7; color: #d63031; }
        .good { background: #dfe6e9; color: #2d3436; }
        .excellent { background: #d5f4e6; color: #00b894; }
        
        .icon {
            margin-right: 5px;
        }
        
        .summary-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .strength-list, .issue-list {
            list-style: none;
            padding: 0;
        }
        
        .strength-list li, .issue-list li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .strength-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #00b894;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .issue-list li:before {
            content: "âš ";
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }
        
        pre {
            background: #2d3436;
            color: #dfe6e9;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        
        .inline-code {
            background: #f1f3f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .grade-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin: 30px 0;
        }
        
        .grade-box .grade {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .action-items {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .priority {
            font-weight: bold;
            color: #d63031;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #667eea;
            color: white;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .recommendation-box {
            background: #e8f4f8;
            border-left: 4px solid #0984e3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .recommendation-box strong {
            color: #0984e3;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 20px;
            }
            
            header {
                padding: 20px;
            }
            
            header h1 {
                font-size: 1.8em;
            }
            
            pre {
                font-size: 0.8em;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ´ Oracle: The Champions of Arcadia</h1>
            <p>Code Quality & Architecture Review</p>
        </header>
        
        <div class="content">
            
            <!-- Critical Issues -->
            <div class="section">                                
                <h3>Memory Management Concerns</h3>
                <p><strong>Problem:</strong> Inconsistent memory ownership patterns:</p>
                <pre><code>// card_actions.c - caller must free
uint8_t* hand_array = HDCLL_toArray(&gstate->hand[player]);
// ... use array ...
free(hand_array);  // Easy to forget!</code></pre>
                
                <div class="recommendation-box">
                    <strong>Best Option:</strong> 
                    <pre><code>// use fixed arrays</code></pre>
                </div>
                
                <h3>Config Structure Scattered</h3>
                <p><strong>Problem:</strong> Configuration handling split between multiple files</p>
                <ul class="issue-list">
                    <li><code class="inline-code">cmdline.c</code> - parsing</li>
                    <li><code class="inline-code">main.c</code> - cleanup</li>
                    <li><code class="inline-code">stda_auto.c</code>, <code class="inline-code">stda_cli.c</code> - usage</li>
                </ul>
                
                <div class="recommendation-box">
                    <strong>Recommendation:</strong> Centralize in new <code class="inline-code">config.h</code> / <code class="inline-code">config.c</code>
                </div>
            </div>

            <!-- Architecture Recommendations -->
            <div class="section">
                <h2>Architecture Recommendations</h2>
                
                <h3>Prepare for Client-Server Split</h3>
                <p>Current code is monolithic. Start preparing for separation:</p>
                <pre><code>// New: game_server.h
typedef struct GameServer GameServer;

GameServer* server_create(uint16_t initial_cash);
void server_apply_action(GameServer* srv, PlayerID player, Action* action);
VisibleGameState server_get_view(GameServer* srv, PlayerID observer);
void server_destroy(GameServer* srv);

// New: game_client.h  
typedef struct GameClient GameClient;

GameClient* client_create(PlayerID player_id);
void client_receive_state(GameClient* cli, VisibleGameState* state);
Action client_get_action(GameClient* cli);  // AI or human input
void client_destroy(GameClient* cli);</code></pre>
                
                <h3>Action Structure</h3>
                <pre><code>// action.h
typedef enum {
    ACTION_PLAY_CHAMPIONS,
    ACTION_PLAY_DRAW_CARD,
    ACTION_PLAY_CASH_CARD,
    ACTION_PASS,
    ACTION_DEFEND,
    ACTION_DISCARD
} ActionType;

typedef struct {
    ActionType type;
    uint8_t num_cards;
    uint8_t card_indices[3];
    uint8_t draw_or_recall;
} Action;

// Clean interface
bool action_is_legal(const Action* action, const VisibleGameState* state);
void action_apply(Action* action, struct gamestate* gstate);</code></pre>
                
                <h3>Visibility System</h3>
                <p>Critical for AI and multiplayer:</p>
                <pre><code>// visibility.h
typedef enum {
    CARD_VISIBLE,
    CARD_KNOWN_IN_OPPONENT_HAND,
    CARD_HIDDEN,
    CARD_KNOWN_IN_OWN_DECK,
    CARD_KNOWN_IN_OPPONENT_DECK
} CardVisibility;

typedef struct {
    struct gamestate base;
    CardVisibility visibility[2][FULL_DECK_SIZE];
} GameStateWithVisibility;</code></pre>
            </div>

            <!-- Code Quality Issues -->
            <div class="section">
                <h2>Code Quality Issues</h2>
                
                <h3>Magic Numbers</h3>
                <pre><code>// stda_auto.c - BAD
if(genRand(&MTwister_rand_struct) > 0.47) return;

// GOOD
#define DEFENSE_PROBABILITY 0.47  // Tunable strategy parameter
if(genRand(&MTwister_rand_struct) > DEFENSE_PROBABILITY) return;</code></pre>
                
                <h3>Error Handling Inconsistency</h3>
                <div class="recommendation-box">
                    <strong>Recommendation:</strong> Consistent error enum:
                    <pre><code>typedef enum {
    GAME_OK = 0,
    GAME_ERR_EMPTY_DECK,
    GAME_ERR_INSUFFICIENT_CASH,
    GAME_ERR_INVALID_CARD,
    GAME_ERR_ILLEGAL_MOVE
} GameError;

GameError DeckStk_pop_safe(struct deck_stack* deck, uint8_t* out);</code></pre>
                </div>                
                
            </div>

            <!-- Action Items -->
            <div class="section">
                <h2>Action Items</h2>
                
                <div class="action-items" style="background: #e3f2fd; border-color: #2196f3;">
                    
                    <ol start="5">
                        <li><strong>Create get_available_moves()</strong> function</li>
                        <li><strong>Implement game state cloning</strong> for MCTS</li>
                        <li><strong>Add phase state machine</strong> for cleaner turn flow</li>
                    </ol>
                </div>
            </div>         
        </div>
    </div>
</body>
</html>
