<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Rating System - Strength Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .section {
            margin-bottom: 40px;
        }
        h2 {
            color: #4a5568;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        tr:hover {
            background: #f7fafc;
        }
        .highlight-row {
            background: #edf2f7;
            font-weight: 600;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }
        .formula-box {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        .key-insight {
            background: #fff5f5;
            border-left: 4px solid #fc8181;
            padding: 15px;
            margin: 20px 0;
        }
        .adaptive-a-box {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            padding: 15px;
            margin: 20px 0;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Oracle: Champions of Arcadia</h1>
        <div class="subtitle">Rating System Analysis - Strength vs Rating Relationship</div>

        <!-- Formulas Section -->
        <div class="section">
            <h2>Core Mathematical Relationships</h2>
            
            <div class="formula-box">
                <strong>Rating to Strength:</strong><br>
                s = R / (100 - R)<br><br>
                <strong>Strength to Rating:</strong><br>
                R = 100 Ã— s / (s + 1)<br><br>
                <strong>Win Probability vs Keeper:</strong><br>
                P(beat Keeper) = s / (s + 1) = R / 100
            </div>

            <div class="key-insight">
                <strong>ðŸ”‘ Key Insight:</strong> The rating scale is non-linear! Each rating point near the extremes (1 or 99) represents a much larger change in actual strength than points near the middle (50).
            </div>
        </div>

        <!-- Adaptive A Section -->
        <div class="section">
            <h2>Adaptive Update Multiplier (A)</h2>
            
            <div class="adaptive-a-box">
                <strong>Adaptive Formula:</strong><br>
                A(games) = 1.08 + (1.3 - 1.08) Ã— e^(-games/150)<br><br>
                â€¢ New players (0 games): A = 1.30 (responsive learning)<br>
                â€¢ Intermediate (100 games): A â‰ˆ 1.19 (moderate)<br>
                â€¢ Experienced (500+ games): A â†’ 1.08 (stable)
            </div>

            <div class="chart-container">
                <canvas id="adaptiveAChart"></canvas>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Games Played</th>
                        <th>Update Multiplier (A)</th>
                        <th>Rating Impact*</th>
                        <th>Player Stage</th>
                    </tr>
                </thead>
                <tbody id="adaptiveATable"></tbody>
            </table>
            <div style="font-size: 12px; color: #718096; margin-top: 10px;">
                *Approximate rating change for an upset win (winning when expected to lose with 30% probability)
            </div>
        </div>

        <!-- Main Table Section -->
        <div class="section">
            <h2>Rating-Strength Conversion Table</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rating (R)</th>
                        <th>Strength (s)</th>
                        <th>Win % vs Keeper</th>
                        <th>Strength Ratio to Keeper</th>
                        <th>Rating Change per Point</th>
                    </tr>
                </thead>
                <tbody id="mainTable"></tbody>
            </table>
        </div>

        <!-- Charts Section -->
        <div class="section">
            <h2>Visual Analysis</h2>
            
            <div class="grid">
                <div class="chart-container">
                    <canvas id="strengthChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="winProbChart"></canvas>
                </div>
            </div>

            <div class="chart-container" style="height: 500px;">
                <canvas id="sensitivityChart"></canvas>
            </div>
        </div>

        <!-- Additional Analysis -->
        <div class="section">
            <h2>Sensitivity Analysis</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rating Range</th>
                        <th>1 Point = Strength Change</th>
                        <th>10 Points = Strength Change</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody id="sensitivityTable"></tbody>
            </table>
        </div>

        <!-- Practical Examples -->
        <div class="section">
            <h2>Practical Examples</h2>
            <table>
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Player Rating</th>
                        <th>Opponent Rating</th>
                        <th>Win Probability</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody id="examplesTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Calculate strength from rating
        function ratingToStrength(rating) {
            return rating / (100 - rating);
        }

        // Calculate rating from strength
        function strengthToRating(strength) {
            return 100 * strength / (strength + 1);
        }

        // Calculate win probability between two players
        function winProbability(s1, s2) {
            return s1 / (s1 + s2);
        }

        // Adaptive A function
        function adaptiveA(games) {
            const A_min = 1.08;
            const A_max = 1.30;
            const decay_rate = 150; // games for exponential decay
            return A_min + (A_max - A_min) * Math.exp(-games / decay_rate);
        }

        // Estimate rating impact for an upset win
        function estimateRatingImpact(A) {
            // Assume: win when expected 30% probability
            // Delta = 1.0 - 0.3 = 0.7
            // Strength multiplier = A^0.7
            // For rating 50 (s=1.0): s_new = 1.0 * A^0.7
            const delta = 0.7;
            const strengthMult = Math.pow(A, delta);
            const s_old = 1.0;
            const s_new = s_old * strengthMult;
            const r_old = strengthToRating(s_old);
            const r_new = strengthToRating(s_new);
            return r_new - r_old;
        }

        // Generate adaptive A table
        const adaptiveAData = [];
        const gamesMilestones = [0, 10, 25, 50, 100, 150, 200, 300, 400, 500, 750, 1000];
        const adaptiveATableBody = document.getElementById('adaptiveATable');
        
        gamesMilestones.forEach(games => {
            const A = adaptiveA(games);
            const impact = estimateRatingImpact(A);
            
            let stage;
            if (games === 0) stage = "New Player";
            else if (games < 50) stage = "Learning";
            else if (games < 200) stage = "Developing";
            else if (games < 500) stage = "Experienced";
            else stage = "Veteran";
            
            adaptiveAData.push({games, A, impact, stage});
            
            const row = adaptiveATableBody.insertRow();
            row.innerHTML = `
                <td>${games}</td>
                <td>${A.toFixed(3)}</td>
                <td>Â±${impact.toFixed(2)} points</td>
                <td>${stage}</td>
            `;
            if (games === 0 || games === 500) {
                row.className = 'highlight-row';
            }
        });

        // Generate main conversion table
        const ratings = [1, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 95, 99];
        const tableData = [];
        const tableBody = document.getElementById('mainTable');

        ratings.forEach(rating => {
            const strength = ratingToStrength(rating);
            const winProb = rating; // Direct relationship for Keeper
            const strengthRatio = strength / 1.0; // Keeper has s=1.0
            
            // Calculate sensitivity (strength change per rating point)
            const strengthPlus1 = ratingToStrength(rating + 1);
            const strengthDelta = ((strengthPlus1 / strength - 1) * 100).toFixed(1);
            
            tableData.push({rating, strength, winProb, strengthRatio, strengthDelta});
            
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td><strong>${rating}</strong></td>
                <td>${strength.toFixed(4)}</td>
                <td>${winProb}%</td>
                <td>${strengthRatio.toFixed(3)}Ã—</td>
                <td>+${strengthDelta}%</td>
            `;
            
            if (rating === 50) {
                row.className = 'highlight-row';
            }
        });

        // Generate sensitivity analysis table
        const ranges = [
            {range: "1-10", start: 1, end: 10},
            {range: "10-20", start: 10, end: 20},
            {range: "40-50", start: 40, end: 50},
            {range: "50-60", start: 50, end: 60},
            {range: "80-90", start: 80, end: 90},
            {range: "90-99", start: 90, end: 99}
        ];
        
        const sensitivityBody = document.getElementById('sensitivityTable');
        ranges.forEach(r => {
            const s_start = ratingToStrength(r.start);
            const s_end = ratingToStrength(r.end);
            const s_plus1 = ratingToStrength(r.start + 1);
            const s_plus10 = ratingToStrength(r.start + 10);
            
            const change1 = ((s_plus1 / s_start - 1) * 100).toFixed(1);
            const change10 = ((s_plus10 / s_start - 1) * 100).toFixed(1);
            
            let interp;
            if (r.start <= 10) interp = "Very high sensitivity - weak players";
            else if (r.start >= 80) interp = "Very high sensitivity - strong players";
            else interp = "Moderate sensitivity - mid-range";
            
            const row = sensitivityBody.insertRow();
            row.innerHTML = `
                <td>${r.range}</td>
                <td>+${change1}%</td>
                <td>+${change10}%</td>
                <td>${interp}</td>
            `;
        });

        // Generate practical examples
        const examples = [
            {desc: "Balanced match", p1: 50, p2: 50},
            {desc: "Slight favorite", p1: 55, p2: 50},
            {desc: "Clear favorite", p1: 65, p2: 50},
            {desc: "Heavy favorite", p1: 75, p2: 50},
            {desc: "Beginner vs Keeper", p1: 20, p2: 50},
            {desc: "Expert vs Keeper", p1: 80, p2: 50},
            {desc: "Two beginners", p1: 25, p2: 20},
            {desc: "Two experts", p1: 85, p2: 80}
        ];
        
        const examplesBody = document.getElementById('examplesTable');
        examples.forEach(ex => {
            const s1 = ratingToStrength(ex.p1);
            const s2 = ratingToStrength(ex.p2);
            const prob = winProbability(s1, s2) * 100;
            
            let interp;
            if (prob < 30) interp = "Underdog";
            else if (prob < 45) interp = "Slight underdog";
            else if (prob < 55) interp = "Even match";
            else if (prob < 70) interp = "Slight favorite";
            else interp = "Heavy favorite";
            
            const row = examplesBody.insertRow();
            row.innerHTML = `
                <td>${ex.desc}</td>
                <td>${ex.p1}</td>
                <td>${ex.p2}</td>
                <td>${prob.toFixed(1)}%</td>
                <td>${interp}</td>
            `;
        });

        // Chart 1: Adaptive A over games
        const ctxA = document.getElementById('adaptiveAChart').getContext('2d');
        const adaptiveAChart = new Chart(ctxA, {
            type: 'line',
            data: {
                labels: adaptiveAData.map(d => d.games),
                datasets: [{
                    label: 'Update Multiplier (A)',
                    data: adaptiveAData.map(d => d.A),
                    borderColor: '#48bb78',
                    backgroundColor: 'rgba(72, 187, 120, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Adaptive Learning Rate: A decreases as player gains experience',
                        font: {size: 14}
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 1.0,
                        max: 1.35,
                        title: {
                            display: true,
                            text: 'Update Multiplier (A)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Games Played'
                        }
                    }
                }
            }
        });

        // Chart 2: Strength vs Rating
        const ctxStrength = document.getElementById('strengthChart').getContext('2d');
        const fullRatings = Array.from({length: 99}, (_, i) => i + 1);
        const strengthChart = new Chart(ctxStrength, {
            type: 'line',
            data: {
                labels: fullRatings,
                datasets: [{
                    label: 'Strength (s)',
                    data: fullRatings.map(r => ratingToStrength(r)),
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Strength vs Rating (Non-linear Relationship)',
                        font: {size: 14}
                    }
                },
                scales: {
                    y: {
                        type: 'logarithmic',
                        title: {
                            display: true,
                            text: 'Strength (s) - Log Scale'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Rating (R)'
                        }
                    }
                }
            }
        });

        // Chart 3: Win Probability
        const ctxWin = document.getElementById('winProbChart').getContext('2d');
        const winProbChart = new Chart(ctxWin, {
            type: 'line',
            data: {
                labels: fullRatings,
                datasets: [{
                    label: 'Win % vs Keeper',
                    data: fullRatings.map(r => r),
                    borderColor: '#fc8181',
                    backgroundColor: 'rgba(252, 129, 129, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Win Probability vs Keeper (Linear by Design)',
                        font: {size: 14}
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Win Probability (%)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Rating (R)'
                        }
                    }
                }
            }
        });

        // Chart 4: Sensitivity (derivative)
        const ctxSens = document.getElementById('sensitivityChart').getContext('2d');
        const sensitivityData = fullRatings.slice(0, -1).map(r => {
            const s = ratingToStrength(r);
            const s_next = ratingToStrength(r + 1);
            return ((s_next / s - 1) * 100);
        });
        
        const sensitivityChart = new Chart(ctxSens, {
            type: 'line',
            data: {
                labels: fullRatings.slice(0, -1),
                datasets: [{
                    label: 'Sensitivity (%)',
                    data: sensitivityData,
                    borderColor: '#ed8936',
                    backgroundColor: 'rgba(237, 137, 54, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Rating Sensitivity: How much does strength change per rating point?',
                        font: {size: 14}
                    }
                },
                scales: {
                    y: {
                        title: {
                            display: true,
                            text: '% Strength Change per Rating Point'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Rating (R)'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>